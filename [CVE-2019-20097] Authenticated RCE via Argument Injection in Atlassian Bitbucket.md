# Description

Mô tả trên trang [Atlassian](https://jira.atlassian.com/browse/BSERV-12099)

<img src="https://imgur.com/78SHZpm.png">

# Patch Analysis
Tải bản có lỗi [6.9.0](https://www.atlassian.com/software/bitbucket/download-archives) và bản vá [6.9.1](https://www.atlassian.com/software/bitbucket/download-archives) sau đó diff hai bản bằng winmerge
<img src="https://imgur.com/qpipHjz.png">
So sánh code giữa hai phiên bản thì thấy ở phiên bản 6.9.1 tại class ```DefaultGitScmCommandBuilder``` tham số "commitish" được kiểm tra bởi hàm ```notBlank()``` trước bước kiểm tra ```startsWith("-")```
<img src="https://imgur.com/tzcls4e.png">
Trong khi đó ở phiên bản 6.9.0 thì diễn ra ngược lại
<img src="https://imgur.com/NIL9xaJ.png">
<img src="https://imgur.com/yT3R42n.png">
Hàm ```notBlank()``` gọi đến ```trim()``` để xóa đi khoảng trắng ở đầu và cuối chuỗi.Điều này đã gọi ý rằng một giá trị của commitish có dạng " -xxx" đã được dùng để khai thác lỗi.

# Setup
Ở đây mình dựng app bằng [docker](https://hub.docker.com/r/atlassian/bitbucket-server/tags?page=1&name=6.9.0)
Sau đó chạy command sau để start container
```
docker run -d -p 8080:7990  -p 5005:5005 -e JAVA_TOOL_OPTIONS="-agentlib:jdwp=transport=dt_socket,address=*:5005,server=y,suspend=n" docker-java-jar:latest
```
Setup debug
Tạo folder ```jar_files_0``` trong ```atlassian-bitbucket-6.9.0``` và dùng command sau để copy tất cả các file jar trong source vào folder này.
```find . -iname '*.jar' -exec cp {} libs_debug \;```
<img src="https://imgur.com/undefined.png">
Mở folder source với intellj idea, vào Project Structure → + → Java
<img src="https://imgur.com/oVpRnEK,png">
Và chọn folder ```jar_files_0```
<img src="https://imgur.com/bCM7iJM.png">
Add thêm Debug configuration như sau:
<img src="https://imgur.com/f1WCY14.png">
